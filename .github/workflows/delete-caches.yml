# Workflow to manage caches used by other workflows
name: Delete caches on completion

on:
  workflow_dispatch:
  #delete:
  #pull_request:
  #  types: 
  #    - closed
  

jobs:
  delete-caches:
    name: delete caches 
    continue-on-error: false
    runs-on: ubuntu-latest
    steps:
      - name: List all caches 
        run: |
          curl -f \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: token $GITHUB_TOKEN" \
            "https://api.github.com/repos/$REPOSITORY/actions/caches
        env:
          GITHUB_TOKEN: ${{ github.token }}
          REPOSITORY: ${{ github.repository }}

      - uses: snnaplab/delete-branch-cache-action@v1
        with:
          ref: refs/pull/${{ github.event.number }}/merge
        if: github.event_name == 'pull_request'

      - uses: snnaplab/delete-branch-cache-action@v1
        with:
          ref: refs/heads/${{ github.event.ref }}
        if: github.event.ref_type == 'branch'

      
        
