# SPDX-FileCopyrightText: Â© 2025 Siemens Healthineers AG
#
# SPDX-License-Identifier: MIT

# This Gateway serves as the central ingress gateway for the cluster.
# HTTPRoutes in any namespace can reference this Gateway by name to handle
# traffic for k2s.cluster.local. See for example:
#  addons/dashboard/manifests/ingress-nginx/dashboard-nginx-gw-route.yaml
#  addons/logging/manifests/opensearch-dashboards/nginx-gw-route.yaml
# The TLS certificate is taken from k8s secret 'k2s-cluster-local-tls'.
# This secret will be created by cert-manager, if it is running.
# If cert-manager is not running, the Gateway may report a Ready condition
# of False until the certificate secret is available.
# For HTTP-only without certificates, use cluster-local-nginx-gw-insecure.yaml instead.
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: nginx-cluster-local
  namespace: nginx-gw
  labels:
    app.kubernetes.io/part-of: nginx-gw
    app.kubernetes.io/name: nginx-gw
    app.kubernetes.io/instance: nginx-gw
spec:
  gatewayClassName: nginx-gw
  listeners:
  - name: http
    hostname: k2s.cluster.local
    port: 80
    protocol: HTTP
    allowedRoutes:
      namespaces:
        from: All
  - name: https
    hostname: k2s.cluster.local
    port: 443
    protocol: HTTPS
    tls:
      mode: Terminate
      certificateRefs:
      - kind: Secret
        name: k2s-cluster-local-tls
    allowedRoutes:
      namespaces:
        from: All
