# SPDX-FileCopyrightText: Â© 2025 Siemens Healthineers AG
#
# SPDX-License-Identifier: MIT

apiVersion: v1
kind: AddonManifest
metadata:
  name: rollout
  description: Automating the deployment/updating of applications using GitOps
spec:
  implementations:
    - name: argocd
      description: Automating the deployment/updating of applications using ArgoCD
      commands:
        enable:
          cli:
            flags:
              - name: ingress
                shorthand: i
                default: none
                description: Ingress controller to use for exposing the ArgoCD dashboard
                constraints:
                  kind: validation-set
                  validationSet:
                    - none
                    - nginx
                    - nginx-gw
                    - traefik
            examples:
              - cmd: k2s addons enable rollout argocd
                comment: Enable rollout with ArgoCD in k2s
              - cmd: k2s addons enable rollout argocd --ingress traefik
                comment: Enable rollout with ArgoCD in k2s with traefik ingress
          script:
            subPath: argocd/Enable.ps1
            parameterMappings:
              - cliFlagName: ingress
                scriptParameterName: Ingress
        disable:
          cli:
            examples:
              - cmd: k2s addons disable rollout argocd
                comment: Disable rollout ArgoCD addon in k2s
          script:
            subPath: argocd/Disable.ps1
    - name: fluxcd
      description: Automating the deployment/updating of applications using Flux CD
      commands:
        enable:
          cli:
            flags:
              - name: ingress
                shorthand: i
                default: none
                description: Ingress controller for webhook receiver (Git push notifications)
                constraints:
                  kind: validation-set
                  validationSet:
                    - none
                    - nginx
                    - nginx-gw
                    - traefik
            examples:
              - cmd: k2s addons enable rollout fluxcd
                comment: Enable rollout with Flux CD in k2s
              - cmd: k2s addons enable rollout fluxcd --ingress nginx
                comment: Enable rollout with Flux CD and webhook ingress in k2s
          script:
            subPath: fluxcd/Enable.ps1
            parameterMappings:
              - cliFlagName: ingress
                scriptParameterName: Ingress
        disable:
          cli:
            examples:
              - cmd: k2s addons disable rollout fluxcd
                comment: Disable rollout Flux CD addon in k2s
          script:
            subPath: fluxcd/Disable.ps1
