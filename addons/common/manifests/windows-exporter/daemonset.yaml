# SPDX-FileCopyrightText: Â© 2025 Siemens Healthineers AG
#
# SPDX-License-Identifier: MIT

apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: windows-exporter
  namespace: kube-system
  labels:
    app: windows-exporter
spec:
  selector:
    matchLabels:
      app: windows-exporter
  template:
    metadata:
      labels:
        app: windows-exporter
    spec:
      nodeSelector:
        kubernetes.io/os: windows
      tolerations:
      - key: "OS"
        operator: "Equal"
        value: "Windows"
        effect: "NoSchedule"
      hostNetwork: true
      securityContext:
        windowsOptions:
          hostProcess: true
          runAsUserName: "NT AUTHORITY\\SYSTEM"
      hostPID: true
      containers:
      - name: windows-exporter
        image: ghcr.io/prometheus-community/windows-exporter:0.31.3 #windows_image
        args:
        - --config.file=C:\\config\\windows_exporter.yaml
        ports:
        - containerPort: 9100
          name: metrics
          protocol: TCP
        env:
        - name: CONTAINER_SANDBOX_MOUNT_POINT
          value: "C:\\"
        volumeMounts:
        - name: config
          mountPath: /config
      volumes:
      - name: config
        configMap:
          name: windows-exporter-config
